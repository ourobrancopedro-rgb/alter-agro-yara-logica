name: Path Allowlist
on:
  pull_request:
    branches: [ main ]

jobs:
  allowlist:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }
      - name: Enforce allowlist
        run: |
          set -eo pipefail
          ALLOWLIST='^(lsa/spec/|rag/spec/|docs/|infra/github/|decisions/|tools/|.github/|README.md$|LICENSE$|pyproject.toml$|.gitignore$)'
          CHANGED=$(git diff --name-only origin/${{ github.base_ref }}... | sed '/^$/d' || true)
          echo "Changed files:"; echo "$CHANGED"
          echo "$CHANGED" | grep -Ev "$ALLOWLIST" && { echo "❌ File outside allowlist."; exit 1; } || echo "✅ Allowlist OK"
